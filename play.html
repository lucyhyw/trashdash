<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<title>Trash Dash</title>
<style type="text/css">
    @font-face {
    font-family: 'Trash Dash';
    src: url('font/Trash-Dash.woff2') format('woff2'),
        url('font/Trash-Dash.woff') format('woff'),
        url('font/Trash-Dash.ttf') format('truetype'),
        url('font/Trash-Dash.svg#Trash-Dash') format('svg');
    font-weight: normal;
    font-style: normal;
    }
</style>
</head>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<body>
<script>
//-----------------------------------Global Variable Definition-----------------------------------\\
//Remove default cursor
document.body.style.cursor = 'none';

//canvas variables
var canvas;
var canvasContext;
//Adjust canvas size based on size of the window. Also defines screenWidth and screenHeight
var screenWidth;
var screenHeight;
resizeScreen();


//Game vars
var keyList = [];//Stores which buttons are being pressed
var wasteList = [];//Stores waste objects on screen
var lives, score, difficulty, level, gameTime;//Time left in a level
var highScore = 0;
var frameTick = 0;//Keeps track of frames for sprite updates
var colorChange = false;
var roundWon = false;
var roundLost = false;
var boss = false;
var bossBegin = false;
var bossLife = 100;
var fakeTrees = [];
var startClick = 0;
var startMail = 0;
var specialFreq = 2;
var firstWaste = true;
var mode = "abc";
var startLives = 3;
var startDifficulty = 1.7;
var speedUp = false;
var wasteRepeat, progress, clickerTime, mailTime;
var plmeCount = 0;
var plmeMode = false;
var openCurriculumMode = false;
var openCurriculumUnlocked = false;
var mute = false;

var pause = false;


//Loading images
var loadCount = 0;
var loadCaptionCount = 0;
var loadStep = 0;


//Different gameplay screens
//Starts game on title screen
var screen;// = "title";


//Static images - text, logos, backgrounds
staticImageText = ["title", "clickToPlay", "pressSpaceForInstructions", "big", "vanWickle", "instructions1", "instructions2", "instructions3", "gameBackground", "josBackground", "rattyBackground", "andrewsBackground", "bossBackground", "iceCream", "andrewsCrowd", "wordBackground", "healthBar", "lastCall", "brokenMachine", "phoLine", "winScreen", "loseScreen", "openCurriculumEnd", "difficultyMode", "abcStatic", "sncStatic", "auditStatic", "plmeTitle", "bluenoIntro", "rockTreeIntro", "riptaIntro", "complete1", "complete2", "todayNotification", "clickerNotification", "announcement1", "healthLabel"];
staticImages = [];
staticImageText.forEach(function(image) {
    window[image] = document.createElement("img");
    staticImages.push(window[image]);
});

loadCaptionsText = ["load1", "load2", "load3", "load4", "load5"];
loadCaptions = [];
loadCaptionsText.forEach(function(image) {
    window[image] = document.createElement("img");
    loadCaptions.push(window[image]);
});



//---------------------------------------- Object Functions --------------------------------\\
//Create New Waste item
function Waste(I, itemIndex) {
    I = I || {}
    I.active = true;
    I.name = itemIndex.name;
    I.speed = difficulty;
    I.type = itemIndex.type;
    I.img = itemIndex.img;
    I.frames = itemIndex.frames;
    I.currentFrame = itemIndex.currentFrame;
    I.yRatio = (Math.random()*(player.img.height - I.img.height)*screenHeight/600 + screenHeight * 3/10)/screenHeight;
    I.xRatio = 1;
    I.riptaSpeed = Math.random()* 6 + 1;
    I.riptaTime = Math.floor(Math.random() * 100 + 30);
    I.riptaCurrent = 0;
    I.riptaState = 'go';
    I.present = false;
    
    
    if (boss == true && level == 1) {
        I.present = true;
    };
    
    I.hit = function() {
        return I.xRatio*screenWidth < player.x + player.img.width/player.frames*screenWidth/800 && I.xRatio*screenWidth + I.img.width/I.frames*screenWidth/800 > player.x + 84*screenWidth/800 && I.type == player.type;
    };
    
    I.inBounds = function() {
        return I.xRatio*screenWidth + I.img.width/I.frames*screenWidth/800 > 0;
    };
    
    I.update = function() {
        if (boss == true && level == 3) {
            if (I.speed != I.riptaSpeed && I.speed != 0) {
                I.speed = I.riptaSpeed;
            };
            if (I.riptaTime == I.riptaCurrent) {
                I.riptaCurrent = 0;
                if (I.riptaState == 'go') {
                    I.riptaState = 'stop';
                    I.speed = 0;
                } else if (I.riptaState == 'stop') {
                    I.riptaState = 'go';
                    I.speed = I.riptaSpeed;
                };
            } else {
                I.riptaCurrent += 1;
            }
        } else {
            I.speed = difficulty;
        };
        I.xRatio -= I.speed/screenWidth * screenWidth/800;
        I.active = I.active && I.inBounds() && (!I.hit() || I.present);
    };
    
    I.draw = function() {
        if (I.present == true) {
            if (frameTick < 17) {
                canvasContext.drawImage(present.img, (I.currentFrame - 1) * present.width, 0, present.width, present.height, I.xRatio * screenWidth, I.yRatio*screenHeight, present.width*screenWidth/800, present.height*screenHeight/600);
            }

            //If it's at the max frame
            else if (I.currentFrame == 2) {
                canvasContext.drawImage(present.img, 0, 0, present.width, present.height, I.xRatio * screenWidth, I.yRatio * screenHeight, present.width*screenWidth/800, present.height*screenHeight/600);
                I.currentFrame = 1;
            } else { //If it's not at its max frame
                canvasContext.drawImage(present.img, present.width, 0, present.width, present.height, I.xRatio * screenWidth, I.yRatio * screenHeight, present.width*screenWidth/800, present.height*screenHeight/600);
                I.currentFrame = 2;
            };
        } else if (I.currentFrame < 3) {
            spriteUpdate(I, 1, 2, I.xRatio*screenWidth, I.yRatio*screenHeight);
        } else {
            spriteUpdate(I, 3,2, I.xRatio*screenWidth, I.yRatio*screenHeight);
        };
    };
    
    return I;
}


//Player properties
var player = {
    type: 'black',//Starts without type
    img: document.createElement("img"),
    currentFrame: 1,
    frames: 16,
    x: screenWidth/15,
    y: screenHeight*3/10
};

var playerStatic = document.createElement("img");


//Button properties
//hover: Is the mouse over the button
//startX and startY allow for scaling of button position according to screen size
function Button(name, startX, startY, action) {
    this.name = name || ""
    this.img = document.createElement("img");
    this.hover = false;
    this.startX = startX || "";
    this.startY = startY || "";
    this.action = action || "";
    this.scaling = 1;

    
    this.draw = function() {
        if(!this.hover) {
            canvasContext.drawImage(this.img, 0, 0, this.img.width/2, this.img.height, this.startX*screenWidth/800, this.startY*screenHeight/600, this.img.width/2*screenWidth/800 * this.scaling, this.img.height*screenHeight/600 * this.scaling);
        } else {
            canvasContext.drawImage(this.img, this.img.width/2, 0, this.img.width/2, this.img.height, this.startX*screenWidth/800, this.startY*screenHeight/600, this.img.width/2*screenWidth/800 * this.scaling, this.img.height*screenHeight/600 * this.scaling);
        }
    };  
    this.mouseOver = function(x,y) {
        if (x >= this.startX*screenWidth/800 && x <= this.startX*screenWidth/800 + this.img.width/2*screenWidth/800 * this.scaling && y >= this.startY*screenHeight/600 && y <= this.startY*screenHeight/600 + this.img.height*screenHeight/600 * this.scaling) {
            this.hover = true;
        } else {
            this.hover = false;
        }
    };
};


//Gameplay A,S,D,W illustration
function directionButton(name, startX, startY) {
    this.base = Button;
    
    this.img = document.createElement("img");
    this.hover = false;
    
    this.action = function(key) {
        if (key == this.name) {
            this.hover = true;
        } else {
            this.hover = false;
        };
    };
    this.base(name, startX, startY, this.action);
    
    this.scaling = 1.5;
};

directionButton.prototype = new Button;


//Instruction waste descriptions
function descriptiveButton(name, startX, startY, descriptionX, descriptionY) {
    this.base = Button;
    
    this.name = name;
    this.description = document.createElement("img");
    
    this.activeDescription = false;
    this.action = function() {
        if (this.hover /*&& !this.activeDescription*/) {
            this.activeDescription = true;
        } else {
            this.activeDescription = false;
        };
    };
    
    this.base(name, startX, startY, this.action);
    
    this.scaling = 0.65;
    
    this.drawDescription = function() {
        if (this.activeDescription) {
            canvasContext.drawImage(this.description, descriptionX*screenWidth/800, descriptionY*screenHeight/600, this.description.width*screenWidth/800, this.description.height*screenHeight/600);
        };
    }
}

descriptiveButton.prototype = new Button;

function newTrees(I) {
    I = I || {}
    I.x = screenWidth/3 + Math.random() * screenWidth*2/3 - 114 * screenWidth/800;
    I.y = screenHeight/3 + Math.random() * screenHeight/3;
    I.currentFrame = 1;
    I.frames = 2;
    I.img = treeImg;
    
    I.draw = function() {
        //colorRect(this.x * screenWidth/800, this.y * screenHeight/600, 200, 100, 'green');
        //colorText("FAKE", I.x * screenWidth/800, I.y * screenHeight/600, 'green');
        spriteUpdate(I, 1, 2, I.x, I.y);
    }
    
    return I;
};


//---------------------------------------------Object Creation ---------------------------------\\


//Waste item properties
//type: trash, recycling, or compost
//currentFrame: Which frame of the sprite sheet should show
//frames: Total number of frames in sprite sheet
wasteTypes = [
{name: 'coldCup',
type: 'none',
frames: 4,
place: [0, 1, 2, 3]},

{name: 'plasticWare',
type: 'gray',
frames: 2,
place: [0, 1, 2, 3]},

{name: 'chips',
type: 'gray',
frames: 2,
place: [0, 1, 2, 3]},

{name: 'marinara',
type: 'blue',
frames: 2,
place: [0, 3]},

{name: 'glassBottle',
type: 'blue',
frames: 2,
place: [0, 2, 3]},

{name: 'lactaid',
type: 'blue',
frames: 2,
place: [0, 1, 2, 3]},

{name: 'pizza',
type: 'green',
frames: 2,
place: [1, 2, 3]},

{name: 'tea',
type: 'green',
frames: 2,
place: [1, 2, 3]},

{name: 'chopSticks',
type: 'green',
frames: 2,
place: [2, 3]},

{name: 'bones',
type: 'green',
frames: 2,
place: [1, 2, 3]},

{name: 'toGo',
type: 'green',
frames: 2,
place: [1, 2, 3]},

/*{name: 'napkins',
type: 'green',
frames: 2,
place: [0]},*/

{name: 'hotCup',
type: 'gray',
frames: 2,
place: [0, 1, 2, 3]},

{name: 'muffin',
type: 'gray',
frames: 2,
place: [0, 1, 3]},

{name: 'condiments',
type: 'gray',
frames: 2,
place: [0, 1, 3]},

{name: 'pho',
type: 'blue',
frames: 2,
place: [2, 3]},

{name: 'pembroke',
type: 'powerDown',
frames: 2,
place: [0, 1, 2, 3],},

{name: 'smoothie',
type: 'powerUp',
frames: 4,
place: [0, 1, 2, 3]},

{name: 'morningMail',
type: 'powerUp',
frames: 2,
place: [0, 1, 2, 3]},

{name: 'iClicker',
type: 'powerUp',
frames: 2,
place: [0, 1, 2, 3]}
];

specialTypes = [
{name: 'pembroke',
type: 'powerDown',
frames: 2,
place: [0, 1, 2, 3],},

{name: 'smoothie',
type: 'powerUp',
frames: 4,
place: [0, 1, 2, 3]},

{name: 'morningMail',
type: 'powerUp',
frames: 2,
place: [0, 1, 2, 3]},

{name: 'iClicker',
type: 'powerUp',
frames: 2,
place: [0, 1, 2, 3]}
];


wasteTypes.forEach(function(waste) {
    waste.currentFrame = 1;
    waste.img = document.createElement("img");
});

present = {
    img: document.createElement("img"),
    width: 94,
    height: 100
};


//Direction Buttons
var directionButtons = [
new directionButton(65, 800/2 - 52*1.5 - (30*1.5)/2, 600*7.7/10 + 52*1.5), //A
new directionButton(68, 800/2 + 30*1.5 - (30*1.5)/2, 600*7.7/10 + 52*1.5), //D
//new directionButton(83, 800/2, 600*7/10 + 52*1.5), //S
new directionButton(87, 800/2 - (30*1.5)/2, 600*7.7/10)]; //W


//Menu Buttons
var menuButtons = [
new Button("moreButton", 800 * 1/10, 600 * 7/10, function() {
    if (this.hover && screen == "title") {
        window.open("https://www.brown.edu/initiatives/brown-is-green/home");
        /*if (plmeCount == 0) {
            plmeTimer();
        };*/
        plmeCount += 1;
        if (plmeCount >= 10) {
            plmeMode = true;
            mode = "snc";
            startLives = 10;
        };
    };
}),

new Button("menuButton", 800 * 1/10, 600 * 7/10, function() {
    if (this.hover && (screen == "end" || (screen == "instruction1" && pause == true))) {
        if (pause == true) {
            pause = false;
            clearInterval(progress);
            wasteList = [];
            difficulty = 1.5;
            clearTimeout(wasteRepeat);
            clearTimeout(clickerTime);
            clearTimeout(mailTime);
            console.log("clear waste");
            //actionSong.pause();
        };
        screen = "title";
        console.log("menuButton");
    }
}),

new Button("backButton", 800 * 1/10, 600 * 7/10, function() {
    if (this.hover) {
        //Go to title if on first page of instructions or go back one page if not when backButton pressed
        if (screen == "instruction1" && pause == false) {
            screen = "title";
            console.log("backButton");
        } else if (screen == "instruction2") {
            screen = "instruction1";
            console.log("back button");
        } else if (screen == "instruction3") {
            screen = "instruction2";
        }
    }
}),

new Button("nextButton", 800 * 9/10 - 150, 600 * 7/10, function() {
    if(this.hover) {// && screen == "instruction1") {
        //Go to the next page unless you are on the last page
        if (screen == "instruction1") {
            screen = "instruction2";
        } else if (screen == "instruction2") {
            screen = "instruction3";
        };
    };
}),
new Button("playButton", 800/2 - 150/2, 600 * 7.5/10, function() {
    if (this.hover) {
        //Start game when playButton pressed
        if (pause == false) {
            openCurriculumMode = false;
            newGame();
        } else {
            togglePause();
        };
        this.hover = false;
    }
}),


new Button("helpButton", 800 * 9/10 - 150, 600 * 7/10, function() {
    if(this.hover && (screen == "end" || screen == "title")) {
        screen = "instruction1";
        console.log("help button");
    }
}),

new Button("openCurriculum", 800/2 - 150/2, 600 * 6/10, function() {
    if (this.hover && openCurriculumUnlocked == true) {
        openCurriculumMode = true;
        newGame();
    };
}),

new Button("abc", (400 - 24) - (50 + 37), 600 * 9.4/10, function() {
    if(this.hover && screen == "title" && plmeMode == false) {
        mode = "abc";
        startDifficulty = 1.7;
        startLives = 3;
    }
}),

new Button("snc", 400 - 24, 600 * 9.4/10, function() {
    if (this.hover && screen == "title" && plmeMode == false) {
        mode = "snc";
        startDifficulty = 1.3;
        startLives = 10;
    }
}),

new Button("audit", (400 + 24) + 50, 600 * 9.4/10, function() {
    if (this.hover && screen == "title" && plmeMode == false) {
        mode = "audit";
        startDifficulty = 1;
        startLives = 0;
    };
}),

new Button("pauseButton", 800 * 6.9/10, 600 * 9.4/10 + 6, function() {
    if (this.hover && screen == "game") {
        togglePause();
    };
}),

new Button("muteButton", 800 * 8/10, 600 * 9.4/10, function() {
    if (this.hover && mute == true) {
        mute = false;
        playMusic();
        //mute = false;
        console.log('unmute');
    };
}),

new Button("volumeButton", 800 * 8/10, 600 * 9.4/10, function() {
    if (this.hover && mute == false) {
        mute = true;
        actionSong.pause();
        //mute = true;
        console.log('mute');
    }
})];


//Descriptive Buttons
var descriptiveButtons = [
new descriptiveButton("chips", 275, 320, 400 - 534/2, 0),
new descriptiveButton("coldCup", 275, 175, 400 - 534/2, 600*4.1/10 + 40),
new descriptiveButton("glassBottle", 370, 175, 400 - 534/2, 600*4.1/10 + 40),
new descriptiveButton("lactaid", 440, 182, 400 - 534/2, 600*4.1/10 + 40),
new descriptiveButton("marinara", 510, 195, 400 - 534/2, 600*4.1/10 + 40),
new descriptiveButton("pho", 585, 185, 400 - 534/2, 600*4.1/10 + 40),
new descriptiveButton("plasticWare", 370, 320, 400 - 534/2, 0),
new descriptiveButton("condiments", 435, 320, 400 - 534/2, 0),
new descriptiveButton("muffin", 515, 335 , 400 - 534/2, 0),
new descriptiveButton("hotCup", 600, 320, 400 - 534/2, 0),
new descriptiveButton("toGo", 275, 260, 400 - 534/2, 600 - 271),
new descriptiveButton("pizza", 370, 270, 400 - 534/2, 600 - 271),
new descriptiveButton("tea", 470, 250, 400 - 534/2, 600 - 271),
new descriptiveButton("bones", 540, 265, 400 - 534/2, 600 - 271),
new descriptiveButton("chopSticks", 630, 265, 400 - 534/2, 600 - 271)];

var buttons = menuButtons.concat(descriptiveButtons);


//Waste Descriptions
/*descriptions = [
{name: 'chips',
x: 800*0.5/10,
y: 0},
{name: 'coldCup',
x: 800*0.4/10,
y: 600*4.1/10},
{name: 'glassBottle',
x: 800*1.28/10,
y: 600*4.1/10},
{name: 'lactaid',
x: 800*1.9/10,
y: 600*4.1/10},
{name: 'marinara',
x: 800*2.57/10,
y: 600*4.1/10},
{name: 'plasticWare',
x: 800*1.25/10,
y: 0},
{name: 'toGo',
x: 800*4.48/10,
y: 600*1.92/10}
];

descriptions.forEach(function(description) {
    description.img = document.createElement("img");
});*/


//Cursor properties
//hover: is the mouse hovering over a button
var cursor = {
    img: document.createElement("img"),
    hover: false
};

var realTree = {
    img: document.createElement("img"),
    x: screenWidth*9/12,
    y: screenHeight*3/10,
    width: 114,
    height: 208,
    currentFrame: 1,
    frames: 4,
    treeTap: 0,
    treesHit: 0,
 
    noHit: false,
    betweenHits: function() {
        if (realTree.noHit == false) {
            realTree.noHit = true;
            this.currentFrame = 3;
            setTimeout(function() {
                realTree.noHit = false;
                this.currentFrame = 1;
            }, 1000);
        };        
    },
    
    draw: function() {
        if (realTree.noHit == false) {
            treeUpdate(realTree, 1, this.x, this.y);
        } else if (realTree.noHit == true) {
            treeUpdate(realTree, 3, this.x, this.y);
        };
    }
};

var ripta = {
    img: document.createElement("img"),
    currentFrame: 1,
    frames: 2,
    x: screenWidth*9/12,
    y: screenHeight*5/10
};

var blueno = {
    img: document.createElement("img"),
    currentFrame: 1,
    frames: 2,
    x: screenWidth*10/15,
    y: screenHeight*3/10
};

var treeImg = document.createElement("img");

var loading = {
    img: document.createElement("img"),
    x: screenWidth/2,
    y: screenHeight/2,
    frames: 3,
    currentFrame: 1
};

//Music
//var actionSong = document.createElement("audio");
var actionSong = new Audio("music/actionSong.wav");


//Create Waste lists for each level
var places = [];
for (var j = 0; j < 5; j++) {
    places[j] = [];
    for (var i = 0; i < wasteTypes.length; i++) {
        if (wasteTypes[i].place.indexOf(j) >= 0) {
            places[j].push(wasteTypes[i]);
        }
    };
};



//---------------------------------------Load images/music-----------------------------------\\
//When the window loads
window.onload = function() {
    //Load canvas
    canvas = document.getElementById('gameCanvas');
    canvasContext = canvas.getContext('2d');
    
    loading.img.src = "images/sprites/loading.png";
    loading.img.onload = function() {
        loadAction();
    };
    
    for (var i = 0; i < loadCaptions.length; i++) {
        loadCaptions[i].src = "images/staticImages/loading/" + loadCaptionsText[i] + ".png";

        loadCaptions[i].onload = function() {
            loadCount += 1;
            loadCaptionCount += 1;
            console.log(loadCount);
        };
    };

    
    
    wasteTypes.forEach(function(waste) {
        waste.img.src = "images/sprites/" + waste.name + ".png";
        
        waste.img.onload = function() {
            loadCount += 1;
            console.log(loadCount);
        };
    });
    
    present.img.src = "images/sprites/present.png";
    
    present.img.onload = function() {
        loadCount += 1;
        console.log(loadCount);
    };
    
    treeImg.src = "images/sprites/fakeTree.png";
    
    treeImg.onload = function() {
        loadCount += 1;
        console.log(loadCount);
    };
        
   for (var i = 0; i < staticImages.length; i++) {
        staticImages[i].src = "images/staticImages/" + staticImageText[i] + ".png";
        
        staticImages[i].onload = function() {
            loadCount += 1;
            console.log(loadCount);
        };
    }

    //Load player sprite
    player.img.src = "images/sprites/runWilliam.png";
    player.img.onload = function() {
        loadCount += 1;
        console.log(loadCount);
    };
    
    playerStatic.src = "images/sprites/williamClassic.png";
    playerStatic.onload = function() {
        loadCount += 1;
        console.log(loadCount);
    };
    
    //boss sprites
    ripta.img.src = "images/sprites/ripta.png";
    ripta.img.onload = function() {
        loadCount += 1;
        console.log(loadCount);
    };
    
    blueno.img.src = "images/sprites/blueno.png";
    blueno.img.onload = function() {
        loadCount += 1;
        console.log(loadCount);
    };
    
    realTree.img.src = "images/sprites/realTree.png";
    realTree.img.onload = function() {
        loadCount += 1;
        console.log(loadCount);
    };
    

    //Load button sprites
    for (var i = 0; i < menuButtons.length; i++) {
        menuButtons[i].img.src = "images/buttons/" + ["moreButton", "menuButton", "backButton", "nextButton", "playButton", "helpButton", "openCurriculum", "abc", "snc", "audit", "pauseButton", "muteButton", "volumeButton"][i] + ".png";
        
        menuButtons[i].img.onload = function() {
            loadCount += 1;
            console.log(loadCount);
        };
    };

    for (var i = 0; i < descriptiveButtons.length; i++) {
        /*descriptiveButtons[i].img.src = "images/buttons/" + ["chipsButton", "coldCupButton", "glassBottleButton", "lactaidButton", "marinaraButton", "plasticWareButton", "toGoButton"][i] + ".png";
        
        descriptions[i].img.src = "images/staticImages/" + ["chipsDescription", "coldCupDescriptionNew", "glassBottleDescription", "lactaidDescription", "marinaraDescription", "plasticWareDescription", "toGoDescription"][i] + ".png";*/
        
        descriptiveButtons[i].img.src = "images/buttons/" + descriptiveButtons[i].name + "Button.png";
        descriptiveButtons[i].description.src = "images/staticImages/" + descriptiveButtons[i].name + "Description.png";
        
        descriptiveButtons[i].img.onload = function() {
            loadCount += 1;
            console.log(loadCount);
        };
        descriptiveButtons[i].description.onload = function() {
            loadCount += 1;
            console.log(loadCount);
        };
    };
    
    for (var i = 0; i < directionButtons.length; i++) {
        directionButtons[i].img.src = "images/buttons/" + ["aDirection", "dDirection",/* "sDirection",*/ "wDirection"][i] + ".png";
        
        directionButtons[i].img.onload = function() {
            loadCount += 1;
            console.log(loadCount);
        };
    };
    
    //Load cursor sprites
    cursor.img.src = "images/sprites/cursor.png";
    cursor.img.onload = function() {
        loadCount += 1;
        console.log(loadCount);
    };
    
    
    //Load music
    //actionSong.src = "music/actionSong.wav";
    
    
    //PowerUp.prototype = new Waste({}, 0)
    events();
    animate();
};


//-------------------------------------------Event listeners------------------------------------\\
function events() {
    //For all key-press events
    document.addEventListener('keydown', function(evt) {
        if (screen == "title") {
            if (evt.keyCode == 32) { //Space-bar
                //openCurriculumUnlocked = true;
            };
        } else if (screen == "game") {
            //Change player.type based on the key pressed
            /*if (evt.keyCode == 68) { //D-key
                player.shirtColor('gray');
            } else if (evt.keyCode == 83) { //S-Key
                player.shirtColor('green');
            } else if (evt.keyCode == 65) { //A-Key
                player.shirtColor('blue');
            }*/
            if (colorChange == false) {
                player.shirtColor(evt.keyCode);
            };
            
            if (evt.keyCode == 32) {
                if (roundWon == true && level < 3) {
                    roundWon = false;
                    level = level + 1;
                    firstWaste = true;
                    addWaste();
                    timer(level);
                };
                if (boss == true && bossBegin == false) {
                    bossBegin = true;
                    firstWaste = true;
                    addWaste();
                    if (level == 2) {
                        treeHit();
                    };
                };
            };
            //Add key to keyList only once per key-press
            /*if (keyList[keyList.length - 1] != evt.keyCode) {
                keyList.push(evt.keyCode);
            }*/
        }
    })
    
    
    //For all key-up events
    /*document.addEventListener('keyup', function(evt) {
        if (screen == "game") {
            //Remove all instances of the key from the keyList whenever that key is lifted
            keyList = keyList.filter(function(keys) {
                return evt.keyCode != keys;
            });
            if (keyList.length == 0) {
                //player.shirtColor('black');
                player.shirtColor();
            } else {
                player.shirtColor(keyList[keyList.length - 1]);
            };
        };
    })*/
    
    
    //For all mouse-move events
    canvas.addEventListener('mousemove', function (evt) {
        //Move cursor to mouse position
        var mousePos = calculateMousePos(evt);
        cursor.x = mousePos.x;
        cursor.y = mousePos.y;
        
        //See if the mouse is hovering over the buttons
        //if (screen == "title" || screen == "instruction1" || screen == "instruction2" || screen == "instruction3" || screen == "end") {
            buttons.forEach(function(button) {
                button.mouseOver(mousePos.x, mousePos.y);
            });
            
            descriptiveButtons.forEach(function(button) {
                button.action();
            })
        //}
    })
    
    //Mouse up events
    canvas.addEventListener('mouseup', function(evt) {
        for (var i = 0; i < menuButtons.length; i ++) {
            if (!actionSong.paused && menuButtons[i].name == "volumeButton") {
                menuButtons[i].action();
                break;
            } else if (actionSong.paused && menuButtons[i].name == "muteButton") {
                menuButtons[i].action();
                break;
            };
        };
        /*if (actionSong.paused) {
            mute = true;
        } else {
            mute = false;
        }*/
    });
    
    
    //For all mouse-click events
    canvas.addEventListener('click', function (evt) {
        /*if (screen == "title") {
            //Start a new game
            //newGame();
        } else*/ if (screen == "game") {
            var mousePos = calculateMousePos(evt);
            
            buttons.forEach(function(button) {
                if (button.name == "pauseButton") {
                    button.action();
                };
            });
            

            //Go through wasteList to see if a coldCup is being pressed
            wasteList.forEach(function(waste) {
                if(waste.name == 'coldCup') {
                    if(click(mousePos.x, mousePos.y, waste)) {
                        waste.currentFrame = 3;
                        waste.type = 'blue';
                    }
                } else if (waste.name == 'iClicker') {
                    if(click(mousePos.x, mousePos.y, waste)) {
                        clickerPower();
                        waste.active = false;
                    };
                } else if (waste.name == 'smoothie') {
                    if(click(mousePos.x, mousePos.y, waste) && waste.type != 'blue') {
                        lives += 1;
                        waste.type = 'blue';
                        waste.currentFrame = 3;
                    };
                } else if (waste.name == 'morningMail') {
                    if(click(mousePos.x, mousePos.y, waste)) {
                        mailPower();
                        waste.active = false;
                    }
                }
                
                if (startClick > 0 && click(mousePos.x, mousePos.y, waste) && (waste.type == 'blue' || waste.type == 'gray' || waste.type == 'green')) {
                    if (mode == "abc") {
                        score += 2;
                    } else if (mode == "snc") {
                        score += 1;
                    };
                    if(openCurriculumMode) {
                        if (mode == "abc") {
                            difficulty += 0.1;
                        } else if (mode == "snc") {
                            difficulty += 0.07;
                        } else if (mode == "audit") {
                            difficulty += 0.05;
                        };
                    };
                    waste.active = false;
                };
            })

            if (bossBegin == true && level == 1) {
                wasteList.forEach(function(waste) {
                    if(mousePos.x >= waste.xRatio*screenWidth && mousePos.x <= waste.xRatio*screenWidth + present.width*screenWidth/800 && mousePos.y >= waste.yRatio*screenHeight && mousePos.y <= waste.yRatio*screenHeight + present.height*screenHeight/600) {
                    //if(click(mousePos.x, mousePos.y, waste)) {
                        if(waste.present == true) {
                            waste.present = false;
                        };
                    };
                })
            } else if (bossBegin == true && level == 2) {
                //if(click(mousePos.x, mousePos.y, realTree))
                if(mousePos.x > realTree.x + realTree.treeTap * 114/10 /2 * screenWidth/800 && mousePos.x < realTree.x + realTree.treeTap * 114/10 /2 * screenWidth/800 + realTree.width && mousePos.y > realTree.y + realTree.treeTap * 208/10 * screenHeight/600 && mousePos.y < realTree.y + realTree.treeTap * 208/10 + realTree.height && realTree.noHit == false) {
                    //realTree.betweenHits();
                    if (realTree.treeTap >= 5) {
                        bossLife -= 10;
                        realTree.height = 208;
                        realTree.width = 114;
                        realTree.treeTap = 0;
                        treeHit();
                    } else {
                        realTree.betweenHits();
                        realTree.treeTap += 1;
                        realTree.height = realTree.height - 208/10;
                        realTree.width = realTree.width - 114/10;
                    };
                } else {
                }
            };
            
        } //else if (screen == "title" || screen == "instruction1" || screen == "instruction2" || screen == "instruction3" || screen == "end") {
        else if (screen != "game") {
            //Handle button presses
            buttons.forEach(function(button) {
                if (button.name == "muteButton") {
                    if (mute == true) {
                        //button.action();
                    }
                } else if(button.name == "volumeButton") {
                    if (mute == false) {
                        //button.action();
                    };
                } else {
                    button.action();
                }
            });

            
            /*backButton.action();
            playButton.action();
            nextButton.action();*/
        }
    });
    
    actionSong.addEventListener('timeupdate', function(){
                var buffer = 5.075;
                if(this.currentTime > this.duration - buffer){
                    this.currentTime = 0
                    this.play()
                }}, false);
};



//------------------------------------------------Animate----------------------------------\\
function animate() {
    //Call this function repeatedly
    requestAnimationFrame(animate);
        
    //Dynamically scale the screen proportionally
    resizeScreen();
    //Resize canvas
    canvasContext.canvas.width = screenWidth;
    canvasContext.canvas.height = screenHeight;
    
    
    if (screen == "game" && pause == false) {
        wasteList.forEach(function(waste) {
            /*if (roundWon == true || (boss == true && bossBegin == false) || screen == "end") {
                clearTimeout(wasteRepeat);
                console.log("no waste");
            };*/
            waste.update();
            if(waste.hit() && waste.present == false) {
                if (mode == "abc") {
                    score += 2;
                } else if (mode == "snc") {
                    score += 1;
                };
                if(openCurriculumMode) {
                    if (mode == "abc") {
                        difficulty += 0.1;
                    } else if (mode == "snc") {
                        difficulty += 0.07;
                    } else if (mode == "audit") {
                        difficulty += 0.05;
                    };
                };
                if (bossBegin == true && (level == 1 || level == 3)) {
                    bossLife -= 10;
                }
            } else if(!waste.inBounds() && waste.type != 'powerUp' && waste.type != 'powerDown') {
                lives -= 1;
                if(lives <= 0 && mode != "audit") {
                    //End game when all lives gone
                    clearInterval(progress);
                    wasteList = [];
                    difficulty = startDifficulty;
                    clearTimeout(wasteRepeat);
                    clearTimeout(clickerTime);
                    clearTimeout(mailTime);
                    console.log("clear waste");
                    screen = "end";
                    //actionSong.pause();
                };
            } else if (waste.name == 'pembroke') {
                pembrokePower(waste);
            };
        })
        wasteList.forEach(function(waste) {
            if (!waste.active) {
            };
        });
        
        wasteList = wasteList.filter(function(waste) {
            return waste.active;
        });

        
        //Draw all images on current screens
        drawGame();
    } else if (screen == "title") {
        drawTitle();
    } else if (screen == "instruction1" || screen == "instruction2" || screen == "instruction3") {
        drawInstruction();
    } else if (screen == "end") {
        drawEnd();
    } else if (screen == "roundOver") {
        drawRoundOver();
    } else if (screen == "load") {
        drawLoad();
    };
    
    
    
    //Draw cursor
    canvasContext.drawImage(cursor.img, cursor.x, cursor.y, cursor.img.width*screenWidth/800* 2/3, cursor.img.height*screenHeight/600 * 2/3);
}



//-------------------------------------------------Game functions---------------------------------------\\
//This function adds waste to the screen at random intervals
function addWaste() {
    //var wasteRepeat;

    //if (difficulty == 1.5 && wasteList.length == 0) {
    if (firstWaste) {
        firstWaste = false;
        if (bossBegin == false) {
            var isSpecial = Math.random() * 10;

            if (isSpecial >= 10 - specialFreq) {
                var itemIndex = wasteTypes[Math.round(Math.random()*(specialTypes.length -1)) + (wasteTypes.length - specialTypes.length)];
            } else {
                var itemIndex = places[level - 1][Math.round(Math.random()*(places[level - 1].length - specialTypes.length - 1))];
            };
            /*var wasteNum = Math.round(Math.random()*(places[level - 1].length - specialTypes.length + 1));
            //var itemIndex = places[level - 1][Math.round(Math.random()*(places[level - 1].length - 1))];
            if (wasteNum >= places[level - 1].length - specialTypes.length) {
                var itemIndex = wasteTypes[Math.round(Math.random()*(specialTypes.length -1)) + (wasteTypes.length - specialTypes.length)];
            } else {
                var itemIndex = places[level - 1][wasteNum];
            };*/
        } else { //No powerUps or powerDowns in boss fights
            var itemIndex = places[level - 1][Math.round(Math.random()*(places[level - 1].length - specialTypes.length - 1))];
        };
        
        if (pause == false) {
            wasteList.push(Waste({}, itemIndex));
        };
        
        //difficulty += 0.2;
    }
    //Add at random intervals
    if (bossBegin == true && level == 3) {
        var timeBetween = 3000;
    //} else if (difficulty >= 5) {
        //var timeBetween = 1000;
    } else {
        var timeBetween = Math.random()*2000 + 1500 / (difficulty / 1.5);
    };
    
    wasteRepeat = setTimeout(function() {



        /*if (roundWon == true || (boss == true && bossBegin == false) || screen == "end") {
            clearTimeout(wasteRepeat);
            console.log("no waste");
        } else {*/
            //Decide waste options according to the game level
            /*if (bossBegin == false) {
                //var itemIndex = places[level - 1][Math.round(Math.random()*(places[level - 1].length - 1))];
            } else {
                var itemIndex = places[level - 1][Math.round(Math.random()*(places[level - 1].length - 5))];
            };*/
            
            if (bossBegin == false) {
                var isSpecial = Math.random() * 10;

                if (isSpecial >= 10 - specialFreq) {
                    var itemIndex = wasteTypes[Math.round(Math.random()*(specialTypes.length -1)) + (wasteTypes.length - specialTypes.length)];
                } else {
                    var itemIndex = places[level - 1][Math.round(Math.random()*(places[level - 1].length - specialTypes.length - 1))];
                };
            } else { //No powerUps or powerDowns in boss fights
                var itemIndex = places[level - 1][Math.round(Math.random()*(places[level - 1].length - specialTypes.length - 1))];
            };
            
            if (pause == false) {
                wasteList.push(Waste({}, itemIndex));
            };
            //Call the same function again to add more waste
            addWaste();
            //difficulty += 0.2;
        //};
    }, timeBetween);
};

//Clock Time:
function clockTime(time, interval) {
    var hourStr = time.substr(0,time.indexOf(':'))
    var minStr = time.substr(time.indexOf(':') + 1, 2)
    var hourInt = parseInt(hourStr);
    var minInt = parseInt(minStr);
    var dayNight = time.substr(time.length - 2, 2);
    
    
    minInt = minInt + interval;
    if (minInt >= 60) {
        hourInt = hourInt + 1;
        minInt = minInt % 60;
    }
    
    if (hourInt == 12 && minInt == 0) {
        
        if (dayNight == 'AM') {
            dayNight = 'PM';
        } else {
            dayNight = 'AM';
        };
    } else if (hourInt > 12) {
        hourInt = hourInt % 12;
    };
    
    if (minInt == 0) {
        minStr = '00';
    } else {
        minStr = minInt.toString();
    }
    hourStr = hourInt.toString();
    
    gameTime = hourStr + ':' + minStr + ' ' + dayNight;
}

//Game timer:
function timer(level) { //waste countDown
    if (level == 1) {
        gameTime = '6:00 PM';
    } else if (level == 2) {
        gameTime = '7:30 AM';
    } else if (level == 3) {
        gameTime = '11:00 AM';
    };
    
    progress = setInterval(function() {
        if ((level == 1 && gameTime == '2:00 AM') || (level == 2 && gameTime == '7:30 PM') || (level == 3 && gameTime == '2:00 AM')) {
            speedUp = false;
            boss = true;
            clearInterval(progress);
            wasteList = [];
            difficulty = startDifficulty;
            clearTimeout(wasteRepeat);
            console.log("clear waste");
            return;
        } else if (pause == false) {
            clockTime(gameTime, 30);
        };/*
        }
        if (gameTime != 0) {
            gameTime -= 1;
        } else {
            screen = "roundOver";
            level += 1;
            clearInterval(progress);
        }*/
    },3000); //should be 3000-----------------------------------------------------Changes speed of game
}


function bossFight(level) {
    //colorRect(10, 10, bossLife * 5, 100, 'red');
    //canvasContext.drawImage(healthBar, healthBar.width - healthBar.width * bossLife/100, 0, healthBar.width * bossLife/100, healthBar.height, 0, screenHeight*0.5/10, (healthBar.width * 1.25) * (bossLife/100) * screenWidth/800, healthBar.height * 1.25 * screenHeight/600);
    canvasContext.drawImage(healthBar, 0, 0, healthBar.width * bossLife/100, healthBar.height, screenWidth - healthBar.width * 1.25 * bossLife/100 * screenWidth/800, screenHeight * 0.8/10, healthBar.width * 1.25 * bossLife/100 * screenWidth/800, healthBar.height * 1.25 * screenHeight/600);
    canvasContext.drawImage(healthLabel, screenWidth * 14/15 - healthLabel.width * screenWidth/800, screenWidth*0.3/10, healthLabel.width * screenWidth/800, healthLabel.height * screenHeight/600);
        //bossLife * 2.75
        //screenHeight * 50/600
    if (level == 1) {
        //colorRect(screenWidth*9/10, screenHeight/2 - 100, 100, 200, 'blue');
        spriteUpdate(blueno, 1, 2, screenWidth * 14/15 - player.img.width/player.frames * screenWidth/800, screenHeight * 3/10 + (player.img.height - blueno.img.height) * screenHeight/600);

        if (bossBegin == false) {
            canvasContext.drawImage(bluenoIntro, (800/2 - (bluenoIntro.width/1)/2) * screenWidth/800, (600/2 - (bluenoIntro.height/1)/2) * screenHeight/600, bluenoIntro.width/1 * screenWidth/800, bluenoIntro.height/1 * screenHeight/600);
        }
        
    } else if(level == 2) {
        //colorRect(realTree.x, realTree.y, realTree.width, realTree.height, 'green');
        //realTree.draw();
        
        if (bossBegin == false) {
            canvasContext.drawImage(rockTreeIntro, (800/2 - (rockTreeIntro.width/1)/2) * screenWidth/800, (600/2 - (rockTreeIntro.height/1)/2) * screenHeight/600, rockTreeIntro.width/1 * screenWidth/800, rockTreeIntro.height/1 * screenHeight/600);
            spriteUpdate(realTree, 1, 2, screenWidth * 14/15 - player.img.width/player.frames * screenWidth/800, screenHeight * 3/10 + (player.img.height - realTree.img.height) * screenHeight/600);
        } else {
            realTree.draw()
        //colorText("REAL", realTree.x, realTree.y, 'green');
            fakeTrees.forEach(function(tree) {
                tree.draw();
            })
        };
    } else if(level == 3) {
        //canvasContext.drawImage(ripta.img, ripta.x, ripta.y);
        spriteUpdate(ripta, 1, 2, screenWidth * 14/15 - player.img.width/player.frames * screenWidth/800, screenHeight * 3/10 + (player.img.height - ripta.img.height) * screenHeight/600);
        //riptaSpeed();
       if (bossBegin == false) {
            canvasContext.drawImage(riptaIntro, (800/2 - (riptaIntro.width/1)/2) * screenWidth/800, (600/2 - (riptaIntro.height/1)/2) * screenHeight/600, riptaIntro.width/1 * screenWidth/800, riptaIntro.height/1 * screenHeight/600);
        }
    }
    
    if (bossLife <= 0) {
        bossBegin = false;
        boss = false;
        roundWon = true;
        bossLife = 100;
        difficulty = startDifficulty;
        wasteList = [];
        clearTimeout(wasteRepeat);
        console.log("clear waste");
        if (level == 3) {
            //actionSong.pause();
            openCurriculumUnlocked = true;
            screen = "end";
        };
    };
};

function treeHit() {
    if (realTree.treesHit != 0) {
        bossLife -= 10;
    };
    
    realTree.treesHit += 1;
    realTree.x = screenWidth/2 + Math.random() * screenWidth/2 - realTree.img.width/realTree.frames * screenWidth/800;
    realTree.y = screenHeight/3 + Math.random() * screenHeight/3;
    fakeTrees = [];
    
    for (var i = 0; i < realTree.treesHit * 2 + 1; i++) {
        fakeTrees.push(newTrees());
    };
};

function challenges() {
    if (level == 1 && boss == false && roundWon == false && (gameTime == '12:00 AM' || gameTime == '12:30 AM' || gameTime == '1:00 AM' || gameTime == '1:30 AM' || gameTime == '2:00 AM')) {
        if (!speedUp) {
            difficulty = difficulty * 2;
        };
        speedUp = true;
        canvasContext.drawImage(lastCall, (400 - 578/2) * screenWidth/800, screenHeight * 2/10, 578 * screenWidth/800, 34 * screenHeight/600);
    } else if (level == 2 && (gameTime == '9:00 AM' || gameTime == '9:30 AM' || gameTime == '10:00 AM')) {
        /*colorRect(screenWidth/3, screenHeight/3, 200, 400);
        colorRect(screenWidth/2, screenHeight/3, 200, 400);
        colorRect(screenWidth*2/3, screenHeight/3, 200, 400);
        colorRect(screenWidth*4/6, screenWidth/3, 200, 400);*/
        canvasContext.drawImage(iceCream, screenWidth/4, screenHeight/5, screenWidth*3/4, screenHeight*3/4);
        canvasContext.drawImage(brokenMachine, (400 - 553/2) * screenWidth/800, screenHeight * 2/10, 553 * screenWidth/800, 34 * screenHeight/600);
    } else if (level == 3 && (gameTime == '1:00 PM' || gameTime == '1:30 PM' || gameTime == '2:00 PM')) {
        //colorRect(screenWidth/2, screenHeight/3, screenWidth/2, 400);
        canvasContext.drawImage(andrewsCrowd, screenWidth*500/800, screenHeight * 3/10, 344 * screenWidth/800, 287 * screenHeight/600);
        canvasContext.drawImage(phoLine, (400 - 297/2) * screenWidth/800, screenHeight * 2/10, 297 * screenWidth/800, 34 * screenHeight/600);
    }
    if (difficulty >= 5 && level == 1) {
        //colorText("Last call", screenWidth/2, screenHeight*3/10, 'black');
    };
};

function clickerPower() {
    startClick += 1;
    clickerTime = setTimeout(function() {
        startClick -= 1;
    }, 5000);
};

function mailPower() {
    difficulty = difficulty / 1.5;
    startMail += 1;
    mailTime = setTimeout(function() {
        difficulty = difficulty * 1.5;
        startMail -= 1;
    }, 5000);
};

function pembrokePower(waste) {
    if (click(cursor.x, cursor.y, waste)) {
        lives -= 1;
        waste.active = false;
        if(lives <= 0 && mode != "audit") {
            //End game when all lives gone
            clearInterval(progress);
            wasteList = [];
            difficulty = startDifficulty;
            clearTimeout(wasteRepeat);
            clearTimeout(clickerTime);
            clearTimeout(mailTime);
            console.log("clear waste");
            screen = "end";
            //actionSong.pause();
        };
    };
};

//Handles sprite clicks
function click(mouseX, mouseY, sprite) {
    return mouseX >= sprite.xRatio*screenWidth && mouseX <= sprite.xRatio*screenWidth + sprite.img.width/sprite.frames*screenWidth/800 && mouseY >= sprite.yRatio*screenHeight && mouseY <= sprite.yRatio*screenHeight + sprite.img.height*screenHeight/600;
}

//This function makes text
function colorText(text, centerX, centerY, fillColor) {
    var textSize = 30 * screenHeight/600;
    var textFont = textSize + "px" + " Trash Dash";
    canvasContext.font = textFont;
    //canvasContext.font = "30px Trash Dash";
    canvasContext.textAlign = "center";
    canvasContext.fillStyle = fillColor;
    canvasContext.fillText(text, centerX, centerY);
}

function colorRect(x, y, width, height, fillColor) {
    canvasContext.fillStyle = fillColor;
    canvasContext.rect(x,y,width,height);
    canvasContext.fill();
}


function calculateMousePos(evt) {
    var rect = canvas.getBoundingClientRect(), root = document.documentElement;
    
    var mouseX = evt.clientX - rect.left - root.scrollLeft;
    var mouseY = evt.clientY - rect.top - root.scrollTop;
    return {
        x: mouseX,
        y: mouseY
    };
}


//Updates sprite sheets
function spriteUpdate(sprite, startFrame, frameSum, x, y) {
    if (frameTick != 17) {
        canvasContext.drawImage(sprite.img, (sprite.currentFrame - 1) * sprite.img.width/sprite.frames, 0, sprite.img.width/sprite.frames, sprite.img.height, x, y, sprite.img.width/sprite.frames*screenWidth/800, sprite.img.height*screenHeight/600);
        return;
    }
    
    //If it's at the max frame
    if (startFrame + (frameSum - 1) == sprite.currentFrame) {
        canvasContext.drawImage(sprite.img, (startFrame - 1) * sprite.img.width/sprite.frames, 0, sprite.img.width/sprite.frames, sprite.img.height, x, y, sprite.img.width/sprite.frames*screenWidth/800, sprite.img.height*screenHeight/600);
        sprite.currentFrame = startFrame;
    } else { //If it's not at its max frame
        canvasContext.drawImage(sprite.img, sprite.currentFrame * sprite.img.width/sprite.frames, 0, sprite.img.width/sprite.frames, sprite.img.height, x, y, sprite.img.width/sprite.frames*screenWidth/800, sprite.img.height*screenHeight/600);
        sprite.currentFrame += 1;
    }
}

function treeUpdate(sprite, startFrame, x, y) {
    if (frameTick != 17) {
        canvasContext.drawImage(sprite.img, (sprite.currentFrame - 1) * sprite.img.width/sprite.frames, 0, sprite.img.width/sprite.frames, sprite.img.height, x + sprite.treeTap * 114/10 /2 * screenWidth/800, y + sprite.treeTap * 208/10 * screenHeight/600, sprite.width*screenWidth/800, sprite.height*screenHeight/600);
    } else if (startFrame + 1 <= sprite.currentFrame) { //max frame
        canvasContext.drawImage(sprite.img, (startFrame - 1) * sprite.img.width/sprite.frames, 0, sprite.img.width/sprite.frames, sprite.img.height, x + sprite.treeTap * 114/10 / 2 * screenWidth/800, y + sprite.treeTap * 208/10 * screenHeight/600, sprite.width*screenWidth/800, sprite.height*screenHeight/600);
        sprite.currentFrame = startFrame;
    } else { //If it's not at its max frame
        canvasContext.drawImage(sprite.img, sprite.currentFrame * sprite.img.width/sprite.frames, 0, sprite.img.width/sprite.frames, sprite.img.height, x + sprite.treeTap * 114/10 /2 * screenWidth/800, y + sprite.treeTap * 208/10 * screenHeight/600, sprite.width*screenWidth/800, sprite.height*screenHeight/600);
        sprite.currentFrame += 1;
    }
};

//Changes shirt color
/*player.shirtColor = function(newType) {
    if (newType == player.type) {
        return;
    }
    
    var sheetNum;
    if (newType == 'blue') {
        sheetNum = 2;
    } else if (newType == 'green') {
        sheetNum = 3;
    } else if (newType == 'gray') {
        sheetNum = 4;
    } else {
        sheetNum = 1;
    }
    
    player.currentFrame += 4 * (sheetNum - Math.ceil(player.currentFrame/4));
    player.type = newType;
}*/
player.shirtColor = function(key = 0) {
    var sheetNum
    if (key == 68 || key == 87 || key == 65) {
        colorChange = true;
    
        if (key == 68) { //D-key
            sheetNum = 4;
            player.type = 'gray';
        } else if (key == 87) { //W-Key
            sheetNum = 3;
            player.type = 'green'
        } else if (key == 65) { //A-Key
            sheetNum = 2;
            player.type = 'blue';
        } else if (key == 83) { //S-Key
            sheetNum = 1;
            player.type = 'black';
        } else {
            sheetNum = 1;
            player.type = 'black';
        };

        directionButtons.forEach(function(button) {
            button.action(key);
        })
        player.currentFrame += 4 * (sheetNum - Math.ceil(player.currentFrame/4));

        setTimeout(function() {
            player.type = 'black';

            player.currentFrame += 4 * (1 - Math.ceil(player.currentFrame/4));
            directionButtons.forEach(function(button) {
                button.action(0);
            })

            colorChange = false;
        }, 500);
    };
};

player.draw = function() {
    if (roundWon == true) {
        canvasContext.drawImage(playerStatic, screenWidth/15, screenHeight*3/10);
    } else if (player.type == 'black') {
        spriteUpdate(player, 1, 4, screenWidth/15, screenHeight*3/10);
    } else if (player.type == 'blue') {
        spriteUpdate(player, 5, 4, screenWidth/15, screenHeight*3/10);
    } else if (player.type == 'green') {
        spriteUpdate(player, 9, 4, screenWidth/15, screenHeight*3/10);
    } else if (player.type == 'gray') {
        spriteUpdate(player, 13, 4, screenWidth/15, screenHeight*3/10);
    };
}



function resizeScreen() {
        if (window.innerWidth < window.innerHeight*800/600) {
        screenWidth = (window.innerWidth - 50);
        screenHeight = (window.innerWidth - 50)*600/800;
    } else {
        screenWidth = (window.innerHeight - 50)*800/600;
        screenHeight = (window.innerHeight - 50);
    }
}

//Restarts the game
function newGame() {
    //actionSong.play();
    screen = "game";
    lives = startLives;
    score = 0;
    difficulty = startDifficulty;
    if (!openCurriculumMode) {
        level = 1;
    } else {
        level = 4;
    };
    wasteList = [];
    firstWaste = true;
    boss = false;
    bossBegin = false;
    roundWon = false;
    startClick = 0;
    startMail = 0;
    speedUp = false;
    keyList = [];
    player.type = 'black';
    if (!openCurriculumMode) {
        timer(level);
    };
    addWaste();
};

function togglePause() {
    if (pause == false) {
        screen = "instruction1";
        pause = true;
        console.log("toggling");
    } else {
        screen = "game";
        pause = false;
    }
};

/*function plmeTimer() {
    setTimeout(function() {
        if (plmeCount < 10) {
            plmeCount = 0;
        } else {
            plmeMode = true;
            mode = "snc";
            startLives = 10;
        };
    }, 5000)
};*/

function notifications() {
    if (roundWon == true) {
        if (level == 1) {
            canvasContext.drawImage(complete1, (800/2 - (complete1.width/1)/2) * screenWidth/800, (600/2 - (complete1.height/1)/2) * screenHeight/600, complete1.width/1 * screenWidth/800, complete1.height/1 * screenHeight/600);
        } else if (level == 2) {
            canvasContext.drawImage(complete2, (800/2 - (complete2.width/1)/2) * screenWidth/800, (600/2 - (complete2.height/1)/2) * screenHeight/600, complete2.width/1 * screenWidth/800, complete2.height/1 * screenHeight/600);
        };
    } else {
        if (startMail > 0) {
            canvasContext.drawImage(todayNotification, screenWidth - (todayNotification.width * 1.5 + 10) * screenWidth/800, 10 * screenHeight/600, todayNotification.width * 1.5 * screenWidth/800, todayNotification.height * 1.5 * screenHeight/600);
            
            canvasContext.drawImage(announcement1, (800/2 - announcement1.width/2) * screenWidth/800, screenHeight/3 + (player.img.height + 5) * screenHeight/600, announcement1.width * screenWidth/800, announcement1.height * screenHeight/600);

            if (startClick > 0) {
                canvasContext.drawImage(clickerNotification, screenWidth - (clickerNotification.width * 1.5 + 10) * screenWidth/800, 50 * screenHeight/600, clickerNotification.width * 1.5 * screenWidth/800, clickerNotification.height * 1.5 * screenHeight/600);
            }
        } else if (startClick > 0) {
            canvasContext.drawImage(clickerNotification, screenWidth - (clickerNotification.width * 1.5 + 10) * screenWidth/800, 10 * screenHeight/600, clickerNotification.width * 1.5 * screenWidth/800, clickerNotification.height * 1.5 * screenHeight/600);
        }
    }
};

function loadAction() {
    screen = "load";
    
    var loadInterval = setInterval(function() {
        if (loadStep == 5) {
            clearInterval(loadInterval);
        }
        
        if (loadCaptionCount == 5) {
            loadStep += 1;
        };
    }, 1000);
    
};

function playMusic() {
    //actionSong.loop = true;
    actionSong.play();
    //actionSong.currentTime = actionSong.duration - 8;

};


//This function draws everything on the screen
function drawGame() {
    frameTick += 1;
    if (frameTick > 17) {
        frameTick = 0;
    }
    if (!openCurriculumMode) {    
        if (level == 1) {
            canvasContext.drawImage(josBackground,0,0, screenWidth, screenHeight);
        } else if (level == 2) {
            canvasContext.drawImage(rattyBackground, 0, 0, screenWidth, screenHeight);
        } else if (level == 3) {
            canvasContext.drawImage(andrewsBackground, 0, 0, screenWidth, screenHeight);
        };
    } else {
        canvasContext.drawImage(bossBackground, 0, 0, screenWidth, screenHeight);
    };
    player.draw();
    
    if (boss == true) {
        bossFight(level);
    }   
    
    wasteList.forEach(function(waste) {
        waste.draw();
    });
    
    challenges();
    directionButtons.forEach(function(button) {
        button.draw();
    })
    
    notifications();
    
    buttons.forEach(function(button) {
        if (button.name == "pauseButton" || (button.name == "muteButton" && mute == true) || (button.name == "volumeButton" && mute == false)) {
            button.draw();
        };
    });
    
    //Draw score
    //colorRect(screenWidth/10, screenHeight/10 - 30, 187, 30, 'white');
    canvasContext.drawImage(wordBackground, screenWidth* 0.5/10, screenHeight*0.8/10, screenWidth*2.5/10, screenHeight*1/10);
    //colorText("SCORE: " + score, screenWidth/10, screenHeight/10, 'black');
    colorText("LIVES: " + lives, screenWidth * 0.5/10 + screenWidth*2.5/10/2, screenHeight*1.6/10, 'black');
    canvasContext.drawImage(wordBackground, screenWidth*3.75/10, screenHeight*0.8/10, screenWidth*2.5/10, screenHeight*1/10);
    if (!openCurriculumMode) {
        colorText(gameTime, screenWidth/2, screenHeight*1.6/10, 'black');
    } else {
        colorText("SCORE: " + score, screenWidth/2, screenHeight*1.6/10, 'black');
    };
    //colorText("LEVEL: " + level, screenWidth/2, screenHeight/6, 'black');
    
}

function drawTitle() {
    //Draw Background
    canvasContext.drawImage(vanWickle, 0,0, screenWidth, screenHeight);
    
    //Draw text, scaled according to screen size
    if (plmeMode == false) {
        canvasContext.drawImage(title, screenWidth/2 - (title.width*screenWidth/800)/2, 10*screenHeight/600, screenWidth*title.width/800, screenHeight*title.height/600);
    } else {
        canvasContext.drawImage(plmeTitle, screenWidth/2 - (plmeTitle.width*screenWidth/800)/2, 10*screenHeight/600, screenWidth*plmeTitle.width/800, screenHeight*title.height/600);
    };
    
           
    /*canvasContext.drawImage(clickToPlay, screenWidth/2 - (clickToPlay.width*screenWidth/800)/2, screenHeight*500/600, screenWidth*clickToPlay.width/800, screenHeight*clickToPlay.height/600);
    
    canvasContext.drawImage(pressSpaceForInstructions, screenWidth/2 - (pressSpaceForInstructions.width*screenWidth/800)/2, screenHeight/2, pressSpaceForInstructions.width*screenWidth/800, pressSpaceForInstructions.height*screenHeight/600);*/
    
    menuButtons.forEach(function(button) {
        if (button.name == "playButton" || button.name == "helpButton" || button.name == "moreButton" || (button.name == "openCurriculum" && openCurriculumUnlocked) || (button.name == "abc" && mode != "abc" && plmeMode == false) || (button.name == "snc" && mode != "snc" && plmeMode == false) || (button.name == "audit" && mode != "audit" && plmeMode == false) || (button.name == "muteButton" && mute == true) || (button.name == "volumeButton" && mute == false)) {
            button.draw();
        };
    });
    
    if (mode == "abc") {
        canvasContext.drawImage(abcStatic, ((800/2 - 24) - (50 + 37) - (50/2 - 38/2)) * screenWidth/800, (600 * 9.4/10 - (26/2 - 17/2)) * screenHeight/600, 50 * screenWidth/800, 26 * screenHeight/600);
    } else if (mode == "snc") {
        canvasContext.drawImage(sncStatic, (800/2 - 70/2) * screenWidth/800, (600 * 9.4/10 - (26/2 - 17/2))* screenHeight/600, 70 * screenWidth/800, 26 * screenHeight/600);
    } else {
        canvasContext.drawImage(auditStatic, (800/2 + 50 + 24 - (87/2 - 57/2)) * screenWidth/800, (600 * 9.4/10 - (26/2 - 17/2)) * screenHeight/600, 87 * screenWidth/800, 26 * screenHeight/600);
    }
    
    canvasContext.drawImage(difficultyMode, screenWidth/2 - 62 * screenWidth/800, screenHeight * 8.9/10, 123 * screenWidth/800, 17 * screenHeight/600);

    
    //Draw BiG logo, scaled according to page size
    canvasContext.drawImage(big, screenWidth*5/800, screenHeight*495/600, big.width*screenWidth/800, big.height*screenHeight/600);
    
    /*var testPowerUp = new PowerUp({}, wasteTypes[1], 0);   
    testPowerUp.draw;*/
}

function drawInstruction() {
    //Draw background
    if (pause == false) {
        canvasContext.drawImage(vanWickle, 0, 0, screenWidth, screenHeight);
    } else if (level == 1) {
        canvasContext.drawImage(josBackground, 0, 0, screenWidth, screenHeight);
    } else if (level == 2) {
        canvasContext.drawImage(rattyBackground, 0, 0, screenWidth, screenHeight);
    } else if (level == 3) {
        canvasContext.drawImage(andrewsBackground, 0, 0, screenWidth, screenHeight);
    } else if (level == 4) {
        canvasContext.drawImage(bossBackground, 0, 0, screenWidth, screenHeight);
    };
    
    //Decide which page of instructions to display
    if (screen == "instruction1") {
        canvasContext.drawImage(instructions1, 0, 0, screenWidth, screenHeight);
    } else if (screen == "instruction2") {
        canvasContext.drawImage(instructions2, 0, 0, screenWidth, screenHeight);
    } else if (screen == "instruction3") {
        canvasContext.drawImage(instructions3, 0, 0, screenWidth, screenHeight);
    }
    

    //Draw buttons
    /*menuButtons.forEach(function(button) {
        button.draw();
    });*/
    menuButtons.forEach(function(button) {
        if ((button.name == "backButton" && (pause == false || (screen == "instruction2" || screen == "instruction3"))) || button.name == "playButton") {
            button.draw();
        } else if (button.name == "nextButton" && (screen == "instruction1" || screen == "instruction2")) {
            button.draw();
        } else if (button.name == "menuButton" && screen == "instruction1" && pause == true) {
            button.draw();
        } else if ((button.name == "muteButton" && mute == true) || (button.name == "volumeButton" && mute == false)) {
            button.draw();
        };
    });
    
    if(screen == "instruction2") {
        descriptiveButtons.forEach(function(button) {
            button.draw();
        });
        for (var i = 0; i < descriptiveButtons.length; i++) {
            descriptiveButtons[i].drawDescription(/*descriptions[i]*/);
        };/*
        descriptiveButtons.forEach(function(button) {
            button.drawDescription(descriptions);
        });*/
        /*
        chipsButton.draw();
        coldCupButton.draw();
        glassBottleButton.draw();
        lactaidButton.draw();
        marinaraButton.draw();
        plasticWareButton.draw();*/
        

    };
    
};

function drawEnd() {
    //level = 1;
    //Draw Background
    //colorRect(0, 0, canvas.width, canvas.height, '#74FF48');
    
        //Calculate high score
    if (openCurriculumMode && score > highScore) {
        highScore = score;
    };
    
    if (!openCurriculumMode && lives > 0) {
        canvasContext.drawImage(winScreen, 0, 0, screenWidth, screenHeight);
    } else if (!openCurriculumMode && lives < 1) {
        canvasContext.drawImage(loseScreen, 0, 0, screenWidth, screenHeight);
    } else {
        canvasContext.drawImage(openCurriculumEnd, 0, 0, screenWidth, screenHeight);
        
        canvasContext.drawImage(wordBackground, screenWidth*3.75/10, screenHeight*3/10, screenWidth*2.5/10, screenHeight*1/10);
        colorText("SCORE: " + score, screenWidth/2, screenHeight*3.8/10, 'black');
    
        canvasContext.drawImage(wordBackground, screenWidth*3.75/10, screenHeight*4.5/10, screenWidth*2.5/10, screenHeight*1/10);
        colorText("HIGH: " + highScore, screenWidth/2, screenHeight*5.3/10, 'black');


    }
    
    
    //Draw Text
    /*colorText("Nice trash sorting", canvas.width/2, 100, 'black')
    canvasContext.font = "40px Arial";
    colorText("You ended up with " + score + " points", canvas.width/2, 200, 'black');
    canvasContext.font = "30px Arial";
    colorText("Your high score is " + highScore + " points", canvas.width/2, 300, 'black');
    canvasContext.font = "60px Arial";
    colorText("Click to Play Again", canvas.width/2, canvas.height*3/4, 'black');*/
    
    menuButtons.forEach(function(button) {
        if (button.name == "menuButton" || button.name == "helpButton" || button.name == "playButton" || (button.name == "openCurriculum" && openCurriculumUnlocked) || (button.name == "muteButton" && mute == true) || (button.name == "volumeButton" && mute == false)) {
            button.draw();
        };
    });
    
}


/*function drawRoundOver() {
    colorText("Nice job. Click to continue", canvas.width/2, canvas.height/2, 'black');
}*/

function drawLoad() {
    frameTick += 1;
    if (frameTick > 17) {
        frameTick = 0;
    };
    
    colorRect(0, 0, screenWidth, screenHeight, '#00cb00');
    spriteUpdate(loading, 1, 3, (800 - loading.img.width/3)/2 * screenWidth/800, (600 - loading.img.height)/2 * screenHeight/600);
    
    if (loadCaptionCount == 5) {
        if (loadStep == 0) {
            canvasContext.drawImage(load1, (800 - load1.width)/2 * screenWidth/800, screenHeight*2/3, load1.width*screenWidth/800, load1.height*screenHeight/600);
        } else if (loadStep == 1) {
            canvasContext.drawImage(load2, (800 - load2.width)/2 * screenWidth/800, screenHeight*2/3, load2.width*screenWidth/800, load2.height*screenHeight/600);
        } else if (loadStep == 2) {
            canvasContext.drawImage(load3, (800 - load3.width)/2 * screenWidth/800, screenHeight*2/3, load3.width*screenWidth/800, load3.height*screenHeight/600);
        } else if (loadStep == 3) {
            canvasContext.drawImage(load4, (800 - load4.width)/2 * screenWidth/800, screenHeight*2/3, load4.width*screenWidth/800, load4.height*screenHeight/600);
        } else if (loadStep == 4) {
            canvasContext.drawImage(load5, (800 - load5.width)/2 * screenWidth/800, screenHeight*2/3, load5.width*screenWidth/800, load5.height*screenHeight/600);
        } else if (loadStep == 5) {
            if (loadCount >= 113) {
                screen = "title";
                playMusic();
            };
        };
    }
};


</script>
</body>
</html>
